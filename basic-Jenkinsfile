// Jenkinsfile for the knet-ci-test/main project
// 1-May-2023    Chrissie Caulfield    original version for running 'old-style' jobs
//

@Library(['CCtestLib']) _

// Globals
def authcheck = true
def nonvoting_fail = 0
def voting_fail = 0
def lockfile ="unknown"

import Jenkins.instance.*
getAllNodes()
{
    allnodes=[]
    a= Jenkins.instance.getNodes()
    for (i in a) {
	allnodes += i.getNodeName()
    }
    return allnodes
}


void testfn(Map args)
{
    println("Called local testfn with ${args['arg']}")
}

pipeline {
    agent { label none }

    stages {
	// This is the main stage that covers everything
	stage('getnodes') {
	    steps {
		script {
		    allnodes = getAllNodes()
		    node(allnodes) {
			steps {
			    println ("${env.NODE_NAME}")
			}
		    }
		}
	    }
	}
    }
}

