// Jenkinsfile for the knet-ci-test/main project
// 1-May-2023    Chrissie Caulfield    original version for running 'old-style' jobs
//


// Globals
def authcheck = true
def nonvoting_fail = 0
def voting_fail = 0
def lockfile ="unknown"

@NonCPS
def getNodes(String label) {
    n =jenkins.model.Jenkins.instance.getNodes()
    println("NODES:", n)
}


pipeline {
    agent { label 'fedora' }

    stages {
	// This is the main stage that covers everything
	stage('Start builds') {
	    // All of the stages that actually do stuff
	    stages {
		// Kick off the real jobs
		stage('Standard builds') {
		    parallel {
			stage('voting') {
			    steps {
				getNodes()
				sh 'date'
				sh 'echo "this is voting"'
				sh 'uname -a'
				sh 'sleep 300'
			    }
			}
			stage('non-voting') {
			    steps {
				sh 'date'
				sh 'echo "this is non-voting"'
				sh 'uname -a'
				sh 'sleep 300'
			    }
			}
			stage('covscan') {
			    steps {
				sh 'date'
				sh 'echo "this is non-voting"'
				sh 'uname -a'
				sh 'sleep 300'
			    }
			}
		    }
		}
	    }
	}
    }
}
