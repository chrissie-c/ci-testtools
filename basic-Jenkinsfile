import Jenkins.instance.*
def getAllNodes()
{
    allnodes=[]
    a= Jenkins.instance.getNodes()
    for (i in a) {
	allnodes += i.getNodeName()
    }
    return allnodes
}


void testfn(Map args)
{
    println("Called local testfn with ${args['arg']}")
}

pipeline {
    agent { label none }

    stages {
	// This is the main stage that covers everything
	stage('getnodes') {
	    steps {
		script {
		    allnodes = getAllNodes()
		    node(allnodes) {
			steps {
			    println ("${env.NODE_NAME}")
			}
		    }
		}
	    }
	}
    }
}

