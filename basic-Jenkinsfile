// Jenkinsfile for the knet-ci-test/main project
// 1-May-2023    Chrissie Caulfield    original version for running 'old-style' jobs
//


// Globals
def authcheck = true
def nonvoting_fail = 0
def voting_fail = 0
def lockfile ="unknown"


pipeline {
    agent { label 'fedora' }

    stages {
	// This is the main stage that covers everything
	stage('Start builds') {
	    environment{
		CREDS = credentials("489d4ea3-11c9-40ab-a794-54197b51f081")
	    }
	    // All of the stages that actually do stuff
	    stages {
		// Kick off the real jobs
		stage('Standard builds') {
		    parallel {
			stage('voting') {
			    when {
				expression { authcheck == true && env.BRANCH_NAME == "main234" }
			    }
			    steps {
				sh "date"
				sh 'echo envcreds $CREDS'
			    }
			}
			stage('non-voting') {
			    steps {
				sh 'date'
			    }
			}
			stage('covscan') {
			    steps {
				sh 'date'
				sh 'echo "this is non-voting"'
			    }
			}
		    }
		}
	    }
	}
    }
}
